<div fxLayout="row" fxLayoutAlign="space-between start" fxLayoutGap="20px">

    <div fxFlex="20">
        <div fxLayout="column">
            <div>
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>State</mat-label>
                    <input matInput [(ngModel)]="action.state" disabled="true">
                </mat-form-field>
            </div>
            <div>
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Priority</mat-label>
                    <input matInput [(ngModel)]="action.priority" disabled="true">
                </mat-form-field>
            </div>
            <div>
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Action percent</mat-label>
                    <input matInput [(ngModel)]="action.actionPercent" disabled="true">
                </mat-form-field>
            </div>
            <div>
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Melee attack type</mat-label>
                    <input matInput [(ngModel)]="action.meleeAttackType" disabled="true">
                </mat-form-field>
            </div>
            <div>
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Melee attack mode</mat-label>
                    <input matInput [(ngModel)]="action.meleeAttackMode" disabled="true">
                </mat-form-field>
            </div>
        </div>
    </div>

    <div fxFlex="20" *ngIf="actionExecutionForm">

        <div fxLayout="column" [formGroup]="actionExecutionForm">
            <div formGroupName="rolls" fxLayout="row" fxLayoutGap="5px">
                <div formGroupName='main-hand' [fxFlex]="actionExecutionForm.value.rolls['off-hand'] ? 50 : 100">
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Main hand attack roll</mat-label>
                        <input matInput formControlName="result" placeholder="Roll" value="">
                    </mat-form-field>
                </div>
                <div formGroupName="off-hand" fxFlex="50" *ngIf="actionExecutionForm.value.rolls['off-hand']">
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Off-hand attack roll</mat-label>
                        <input matInput formControlName="result" placeholder="Roll" value="">
                    </mat-form-field>
                </div>
            </div>
            <div formGroupName="targets" fxLayout="row" fxLayoutGap="5px">
                <div [fxFlex]="displayOffHandTarget() ? 50 : 100">
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Main hand target</mat-label>
                        <mat-select formControlName="main-hand">
                            <mat-option *ngFor="let option of availableTargets" [value]="option.key">{{option.name}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div fxFlex="50" *ngIf="displayOffHandTarget()">
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Off-hand target</mat-label>
                        <mat-select formControlName="off-hand">
                            <mat-option *ngFor="let option of availableTargets" [value]="option.key">{{option.name}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
            </div>
            <div formGroupName="facingMap" fxLayout="row" fxLayoutGap="5px">
                <div [fxFlex]="actionExecutionForm.value.facingMap['off-hand'] ? 50 : 100">
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Main hand facing</mat-label>
                        <mat-select formControlName="main-hand">
                            <mat-option *ngFor="let option of meleeAttackFacingValues" [value]="option.key">{{option.name}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div fxFlex="50" *ngIf="actionExecutionForm.value.facingMap['off-hand']">
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Off-hand facing</mat-label>
                        <mat-select formControlName="off-hand">
                            <mat-option *ngFor="let option of meleeAttackFacingValues" [value]="option.key">{{option.name}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
            </div>



            <div fxLayout="column" *ngIf="breakageExecutionForm" [formGroup]="breakageExecutionForm">
                <div formGroupName="rolls">
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Main breakage</mat-label>
                        <input matInput formControlName="main-hand" placeholder="Breakage roll">
                    </mat-form-field>
                </div>

            </div>

            <div fxLayout="column" *ngIf="criticalExecutionForm" [formGroup]="criticalExecutionForm">
                <div formGroupName="rolls">
                    <div *ngFor="let rollKey of getCriticalRollKeys()">
                        <mat-form-field appearance="outline" class="full-width">
                            <mat-label>{{rollKey}}</mat-label>
                            <input matInput formControlName="{{rollKey}}" placeholder="Critical roll">
                        </mat-form-field>
                    </div>
                </div>
            </div>
        </div>


    </div>
    <div fxFlex="30">
        <app-attack-result [action]="action"></app-attack-result>
    </div>

    <div fxFlex="30">
        <div *ngIf="action.criticalResults['main-hand']">
            <h2>Main hand critical</h2>
            <app-critical-result-view *ngFor="let critical of action.criticalResults['main-hand']" [critical]="critical"></app-critical-result-view>
        </div>
        <div *ngIf="action.criticalResults['off-hand']" style="margin-top: 20pt;">
            <h2>Off-hand critical</h2>
            <app-critical-result-view *ngFor="let critical of action.criticalResults['off-hand']" [critical]="critical"></app-critical-result-view>
        </div>
    </div>
</div>

<mat-dialog-actions *ngIf="actionExecutionForm">
    <button mat-stroked-button mat-dialog-close>Close</button>
    <button mat-stroked-button (click)="resolveMeleeAttackAction()" [disabled]="actionExecutionForm!.invalid || this.action.state !== 'pending'">Resolve
        attack</button>
    <button mat-stroked-button *ngIf="breakageExecutionForm" (click)="resolveBreakageAction()"
        [disabled]="breakageExecutionForm!.invalid || this.action.state !== 'pending-breakage-resolution'">Resolve breakage</button>
    <button mat-stroked-button *ngIf="criticalExecutionForm" (click)="resolveCriticalAction()"
        [disabled]="criticalExecutionForm!.invalid || this.action.state !== 'pending-critical-resolution'">Resolve critical</button>
</mat-dialog-actions>

<br>