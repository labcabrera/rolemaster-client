<div fxLayout="row" fxLayoutAlign="space-between start" fxLayoutGap="20px">

    <div fxFlex="20">

        <div fxLayout="column">
            <div><b>Type</b>: {{action.type}}</div>
            <div><b>State</b>: {{action.state}}</div>
            <div><b>Priority</b>: {{action.priority}}</div>
            <div><b>Percent</b>: {{action.actionPercent}}</div>
            <div><b>Melee attack type</b>: {{action.meleeAttackType}}</div>
        </div>

    </div>

    <div fxFlex="20" *ngIf="actionExecutionForm">

        <div fxLayout="column" [formGroup]="actionExecutionForm">
            <div formGroupName="rolls" fxLayout="row" fxLayoutGap="5px">
                <div formGroupName='main-hand' [fxFlex]="actionExecutionForm.value.rolls['off-hand'] ? 50 : 100">
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Main hand attack roll</mat-label>
                        <input matInput formControlName="result" placeholder="Roll" value="">
                    </mat-form-field>
                </div>
                <div formGroupName="off-hand" fxFlex="50" *ngIf="actionExecutionForm.value.rolls['off-hand']">
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Off-hand attack roll</mat-label>
                        <input matInput formControlName="result" placeholder="Roll" value="">
                    </mat-form-field>
                </div>
            </div>
            <div formGroupName="targets" fxLayout="row" fxLayoutGap="5px">
                <div [fxFlex]="displayOffHandTarget() ? 50 : 100">
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Main hand target</mat-label>
                        <mat-select formControlName="main-hand">
                            <mat-option *ngFor="let option of availableTargets" [value]="option.key">{{option.name}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div fxFlex="50" *ngIf="displayOffHandTarget()">
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Off-hand target</mat-label>
                        <mat-select formControlName="off-hand">
                            <mat-option *ngFor="let option of availableTargets" [value]="option.key">{{option.name}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
            </div>
            <div formGroupName="facingMap" fxLayout="row" fxLayoutGap="5px">
                <div  [fxFlex]="actionExecutionForm.value.facingMap['off-hand'] ? 50 : 100">
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Main hand facing</mat-label>
                        <mat-select formControlName="main-hand">
                            <mat-option *ngFor="let option of meleeAttackFacingValues" [value]="option.key">{{option.name}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div fxFlex="50" *ngIf="actionExecutionForm.value.facingMap['off-hand']">
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Off-hand facing</mat-label>
                        <mat-select formControlName="off-hand">
                            <mat-option *ngFor="let option of meleeAttackFacingValues" [value]="option.key">{{option.name}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <!--
                <div *ngIf="action.state == 'pending-critical-resolution'">
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Critical roll</mat-label>
                        <input matInput placeholder="Critical roll" value="" [(ngModel)]="criticalExecution.roll">
                    </mat-form-field>
                </div>
                <div *ngIf="action.state == 'pending-fumble-resolution'">
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Critical roll</mat-label>
                        <input matInput placeholder="Critical roll" value="" [(ngModel)]="fumbleExecution.roll">
                    </mat-form-field>
                </div>
            -->
            </div>
            <button mat-button color="primary" (click)="executeMeleeAttackAction()" [disabled]="actionExecutionForm!.invalid || this.action.state !== 'pending'">Resolve attack</button>

        </div>


    </div>
    <div fxFlex="30">
        <app-attack-result [action]="action"></app-attack-result>
    </div>

    <div fxFlex="30">
        <app-critical-result-view [action]="action"></app-critical-result-view>
    </div>
</div>

<pre>{{actionExecutionForm.value | json}}</pre>